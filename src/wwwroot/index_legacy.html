<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDL Scoreboard</title>
    <script>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    user-select: none;
}

body {
    font-family: Arial, sans-serif;
    background-color: #000;
    color: #fff;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.scoreboard {
    width: 100%;
    max-width: 1200px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.scores {
    width: 100%;
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}

.team {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 45%;
}

.team-name {
    font-size: 2rem;
    margin-bottom: 10px;
    text-transform: uppercase;
}

.score {
    font-size: 10rem;
    font-weight: bold;
    cursor: pointer;
    background-color: #333;
    padding: 20px 40px;
    border-radius: 10px;
    min-width: 200px;
    text-align: center;
}

.timer-container {
    width: 80%;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 30px;
}

.timer-container {
    position: relative;
}

.timer {
    font-size: 14rem;
    font-weight: bold;
    cursor: pointer;
    background-color: #333;
    padding: 20px 40px;
    border-radius: 10px;
    min-width: 400px;
    text-align: center;
}

.timer-status {
    margin-top: 15px;
    font-size: 1.5rem;
    color: #aaa;
}

.score-history {
    margin-top: 15px;
    font-size: 1.5rem;
    color: #aaa;
    display: flex;
    justify-content: center;
    gap: 10px;
}

.period-score {
    padding: 5px 10px;
    background-color: rgba(51, 51, 51, 0.7);
    border-radius: 5px;
    border: 1px solid gray;
}

.control-buttons {
    position: absolute;
    bottom: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 100;
}

.control-btn {
    background-color: rgba(51, 51, 51, 0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.3s;
}

    .control-btn:hover {
        background-color: rgba(51, 51, 51, 1);
    }

.settings-panel {
    position: absolute;
    bottom: 80px;
    right: 20px;
    background-color: rgba(51, 51, 51, 0.9);
    border: 1px solid gray;
    border-radius: 10px;
    padding: 20px;
    width: 300px;
    max-height: 80vh;
    overflow-y: auto;
    display: none;
    z-index: 99;
}

    .settings-panel.active {
        display: block;
    }

    .settings-panel h3 {
        margin-bottom: 15px;
        text-align: center;
    }

.settings-group {
    margin-bottom: 15px;
}

    .settings-group label {
        display: block;
        margin-bottom: 5px;
    }

    .settings-group input {
        padding: 8px;
        background-color: #444;
        border: 1px solid gray;
        border-radius: 5px;
        color: white;
    }
        .settings-group input:focus-visible {
            outline: solid 1px lightgray;
            backdrop-filter: drop-shadow();
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

    .settings-group button {
        padding: 8px;
        background-color: #444;
        border: 1px solid gray;
        border-radius: 5px;
        color: white;
        cursor: pointer;
        margin-top: 5px;
    }

        .settings-group button:hover {
            background-color: #555;
        }

    .team-settings {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }

    .team-settings input {
        margin-right: 8px;
    }

    .decrement-btn {
        padding: 4px 8px;
        background-color: #444;
        color: white;
        border: 1px solid gray;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        margin-left: 5px;
    }

    .decrement-btn:hover {
        background-color: #555;
    }

@media (max-width: 768px) {
    .team-name {
        font-size: 1.5rem;
    }

    .score {
        font-size: 5rem;
        min-width: 120px;
        padding: 10px 20px;
    }

    .timer {
        font-size: 6rem;
        min-width: 280px;
        padding: 10px 20px;
    }
}

/* Landscape mode for widescreen */
@media (orientation: landscape) and (max-height: 600px) {
    .scoreboard {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
    }

    .scores {
        flex-direction: column;
        width: 30%;
        margin-bottom: 0;
        margin-right: 20px;
    }

    .team {
        width: 100%;
        margin-bottom: 20px;
    }

    .timer-container {
        width: 60%;
        margin-top: 0;
    }

    .timer {
        font-size: 8rem;
    }
}

    </script>
    <script>
        
class ScoreboardApp {
    constructor() {
        // Initialize components
        this.timer = new Timer(this);
        this.teams = new Teams(this);
        this.settings = new Settings(this);
        this.ui = new UI(this);

        // Global state
        this.periodScores = [];
        this.wakeLock = null;

        // Initialize app
        this.loadSavedSettings();
    }

    // Load saved settings from localStorage
    loadSavedSettings() {
        // Font sizes
        if (localStorage.getItem('scoreFontSize')) {
            const savedScoreFontSize = localStorage.getItem('scoreFontSize');
            this.ui.updateScoreFontSize(savedScoreFontSize);
            this.settings.scoreFontSizeSlider.value = savedScoreFontSize;
        }

        if (localStorage.getItem('timerFontSize')) {
            const savedTimerFontSize = localStorage.getItem('timerFontSize');
            this.ui.updateTimerFontSize(savedTimerFontSize);
            this.settings.timerFontSizeSlider.value = savedTimerFontSize;
        }

        // Screen wake lock
        if (localStorage.getItem('keepScreenOn') === 'true') {
            this.settings.keepScreenOnCheckbox.checked = true;
            this.requestWakeLock();
        }
    }


    // Capture score at end of timer
    captureScore() {
        this.periodScores.push(`${this.teams.team1Points} - ${this.teams.team2Points}`);
        this.ui.updateScoreHistory();
    }

    // Reset score history
    resetScoreHistory() {
        this.periodScores = [];
        this.ui.updateScoreHistory();
    }

    // Wake Lock API functions
    async requestWakeLock() {
        if ('wakeLock' in navigator) {
            try {
                this.wakeLock = await navigator.wakeLock.request('screen');
                console.log('Wake Lock is active');
                document.addEventListener('visibilitychange', this.handleVisibilityChange.bind(this));
            } catch (err) {
                console.error(`Failed to get wake lock: ${err.message}`);
            }
        } else {
            console.warn('Wake Lock API not supported in this browser');
            alert('Keep screen on feature is not supported in your browser');
            this.settings.keepScreenOnCheckbox.checked = false;
        }
    }

    releaseWakeLock() {
        if (this.wakeLock !== null) {
            this.wakeLock.release()
                .then(() => {
                    console.log('Wake Lock has been released');
                    this.wakeLock = null;
                });
            document.removeEventListener('visibilitychange', this.handleVisibilityChange);
        }
    }

    handleVisibilityChange() {
        if (document.visibilityState === 'visible' && this.settings.keepScreenOnCheckbox.checked) {
            this.requestWakeLock();
        }
    }

    toggleWakeLock() {
        if (this.settings.keepScreenOnCheckbox.checked) {
            this.requestWakeLock();
            localStorage.setItem('keepScreenOn', 'true');
        } else {
            this.releaseWakeLock();
            localStorage.setItem('keepScreenOn', 'false');
        }
    }
}

class Timer {
    constructor(app) {
        this.app = app;

        // Elements
        this.timerDisplay = document.getElementById('timer');
        this.alarm = document.getElementById('alarm');

        // Timer state
        this.timeLeft = 15 * 60; // Default: 15 minutes in seconds
        this.isRunning = false;
        this.interval = null;
        this.lastTap = 0;

        // Initialize
        this.updateDisplay();
        this.setupEventListeners();
    }

    setupEventListeners() {
        this.timerDisplay.addEventListener('click', this.handleTimerTap.bind(this));
    }

    startStop() {
        if (this.isRunning) {
            // Stop timer
            clearInterval(this.interval);
            this.isRunning = false;
        } else {
            // Start timer
            this.isRunning = true;
            this.interval = setInterval(() => {
                this.timeLeft--;
                this.updateDisplay();

                if (this.timeLeft <= 0) {
                    clearInterval(this.interval);
                    this.isRunning = false;

                    // Capture score and play alarm
                    this.app.captureScore();
                    this.playAlarm();

                    // Reset timer to configured time
                    this.timeLeft = parseInt(this.app.settings.timerMinutesInput.value) * 60;
                    this.updateDisplay();
                }
            }, 1000);
        }
    }

    reset() {
        clearInterval(this.interval);
        this.isRunning = false;
        this.timeLeft = parseInt(this.app.settings.timerMinutesInput.value) * 60;
        this.updateDisplay();
        this.timerDisplay.style.backgroundColor = '#333';
    }

    updateDisplay() {
        this.timerDisplay.textContent = this.formatTime(this.timeLeft);
    }

    formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    playAlarm() {
        this.alarm.play();
        
        // Blink red a few times
        let blinkCount = 0;
        const blinkInterval = setInterval(() => {
            if (blinkCount >= 5) {
                clearInterval(blinkInterval);
                this.timerDisplay.style.backgroundColor = '#333';
                return;
            }
            
            if (blinkCount % 2 === 0) {
                // Turn red
                this.timerDisplay.style.backgroundColor = '#f00';
            } else {
                // Turn back to normal
                this.timerDisplay.style.backgroundColor = '#333';
            }
            
            blinkCount++;
        }, 250);
    }

    simulateTimerEnd() {
        // Stop the timer if it's running
        if (this.isRunning) {
            clearInterval(this.interval);
            this.isRunning = false;
        }
        
        // Capture score and play alarm
        this.app.captureScore();
        this.playAlarm();
        
        // Reset timer to configured time
        this.timeLeft = parseInt(this.app.settings.timerMinutesInput.value) * 60;
        this.updateDisplay();
    }

    handleTimerTap() {
        const now = new Date().getTime();
        const timeSince = now - this.lastTap;

        if (timeSince < 300 && timeSince > 0) {
            // Double tap - reset timer
            this.reset();
        } else {
            // Single tap - start/stop
            this.startStop();
        }

        this.lastTap = now;
    }

    setTime(minutes) {
        if (minutes > 0 && minutes <= 60) {
            clearInterval(this.interval);
            this.isRunning = false;
            this.timeLeft = minutes * 60;
            this.updateDisplay();
            this.timerDisplay.style.backgroundColor = '#333';
        }
    }
}

class Teams {
    constructor(app) {
        this.app = app;

        // Team scores
        this.team1Points = 0;
        this.team2Points = 0;

        // Team elements
        this.team1ScoreElement = document.getElementById('score-team1');
        this.team2ScoreElement = document.getElementById('score-team2');
        this.team1NameElement = document.querySelector('.team:nth-of-type(1) .team-name');
        this.team2NameElement = document.querySelector('.team:nth-of-type(2) .team-name');

        // Initialize
        this.updateScoreDisplay();
        this.setupEventListeners();
    }

    setupEventListeners() {
        // Score increment on click
        this.team1ScoreElement.addEventListener('click', () => this.incrementScore(1));
        this.team2ScoreElement.addEventListener('click', () => this.incrementScore(2));

        // Score decrement on long press
        let pressTimer;

        this.team1ScoreElement.addEventListener('touchstart', () => {
            pressTimer = window.setTimeout(() => {
                this.decrementScore(1);
            }, 800);
        });

        this.team2ScoreElement.addEventListener('touchstart', () => {
            pressTimer = window.setTimeout(() => {
                this.decrementScore(2);
            }, 800);
        });

        // Clear timeouts on touch end
        this.team1ScoreElement.addEventListener('touchend', () => {
            clearTimeout(pressTimer);
        });

        this.team2ScoreElement.addEventListener('touchend', () => {
            clearTimeout(pressTimer);
        });
        
        // Team name sync from UI to settings
        this.team1NameElement.addEventListener('input', () => {
            this.app.settings.team1NameInput.value = this.team1NameElement.textContent;
        });
        
        this.team2NameElement.addEventListener('input', () => {
            this.app.settings.team2NameInput.value = this.team2NameElement.textContent;
        });
    }

    incrementScore(teamNumber) {
        if (teamNumber === 1) {
            this.team1Points++;
        } else {
            this.team2Points++;
        }
        this.updateScoreDisplay();
    }

    decrementScore(teamNumber) {
        if (teamNumber === 1 && this.team1Points > 0) {
            this.team1Points--;
        } else if (teamNumber === 2 && this.team2Points > 0) {
            this.team2Points--;
        }
        this.updateScoreDisplay();
    }

    updateScoreDisplay() {
        this.team1ScoreElement.textContent = this.team1Points;
        this.team2ScoreElement.textContent = this.team2Points;
    }

    setTeamNames(team1Name, team2Name) {
        this.team1NameElement.textContent = team1Name;
        this.team2NameElement.textContent = team2Name;
    }

    reset() {
        this.team1Points = 0;
        this.team2Points = 0;
        this.updateScoreDisplay();
    }
}

class Settings {
    constructor(app) {
        this.app = app;

        // Elements
        this.settingsBtn = document.getElementById('settings-btn');
        this.settingsPanel = document.getElementById('settings-panel');
        this.timerMinutesInput = document.getElementById('timer-minutes');
        this.setTimerBtn = document.getElementById('set-timer-btn');
        this.team1NameInput = document.getElementById('team1-name');
        this.team2NameInput = document.getElementById('team2-name');
        this.resetScoresBtn = document.getElementById('reset-scores-btn');
        this.resetHistoryBtn = document.getElementById('reset-history-btn');
        this.testBuzzerBtn = document.getElementById('test-buzzer-btn');
        this.scoreFontSizeSlider = document.getElementById('score-font-size');
        this.timerFontSizeSlider = document.getElementById('timer-font-size');
        this.keepScreenOnCheckbox = document.getElementById('keep-screen-on');

        // Initialize
        this.updateInputsFromCurrent();
        this.setupEventListeners();
    }

    updateInputsFromCurrent() {
        // Get current values from the UI
        this.team1NameInput.value = this.app.teams?.team1NameElement?.textContent || 'BLACK';
        this.team2NameInput.value = this.app.teams?.team2NameElement?.textContent || 'WHITE';
        this.timerMinutesInput.value = Math.floor((this.app.timer?.timeLeft || 900) / 60);
    }

    setupEventListeners() {
        // Settings panel toggle
        this.settingsBtn.addEventListener('click', () => this.toggle());

        // Close settings when clicking outside
        document.addEventListener('click', (e) => {
            if (!this.settingsPanel.contains(e.target) &&
                e.target !== this.settingsBtn &&
                !this.settingsBtn.contains(e.target)) {
                this.settingsPanel.classList.remove('active');
            }
        });

        // Settings buttons
        this.setTimerBtn.addEventListener('click', () => {
            this.app.timer.setTime(parseInt(this.timerMinutesInput.value));
        });
        
        // Team score decrement buttons
        document.getElementById('team1-decrement').addEventListener('click', () => {
            this.app.teams.decrementScore(1);
        });
        
        document.getElementById('team2-decrement').addEventListener('click', () => {
            this.app.teams.decrementScore(2);
        });

        // Team name sync from settings to UI
        this.team1NameInput.addEventListener('input', () => {
            this.app.teams.team1NameElement.textContent = this.team1NameInput.value;
        });
        
        this.team2NameInput.addEventListener('input', () => {
            this.app.teams.team2NameElement.textContent = this.team2NameInput.value;
        });

        this.resetScoresBtn.addEventListener('click', () => {
            this.app.teams.reset();
        });

        this.resetHistoryBtn.addEventListener('click', () => {
            this.app.resetScoreHistory();
        });

        this.testBuzzerBtn.addEventListener('click', () => {
            this.app.timer.playAlarm();
        });

        // Simulate timer end button
        document.getElementById('simulate-timer-end-btn').addEventListener('click', () => {
            this.app.timer.simulateTimerEnd();
        });

        // Font size sliders
        this.scoreFontSizeSlider.addEventListener('input', (e) => {
            this.app.ui.updateScoreFontSize(e.target.value);
        });

        this.timerFontSizeSlider.addEventListener('input', (e) => {
            this.app.ui.updateTimerFontSize(e.target.value);
        });

        // Wake lock checkbox
        this.keepScreenOnCheckbox.addEventListener('change', () => {
            this.app.toggleWakeLock();
        });
    }

    toggle() {
        this.settingsPanel.classList.toggle('active');
    }
}

class UI {
    constructor(app) {
        this.app = app;

        // UI elements
        this.fullscreenBtn = document.getElementById('fullscreen-btn');
        this.scoreHistoryElement = document.getElementById('score-history');

        // Set up event listeners
        this.setupEventListeners();
    }

    setupEventListeners() {
        this.fullscreenBtn.addEventListener('click', () => this.toggleFullscreen());
    }

    toggleFullscreen() {
        if (!document.fullscreenElement) {
            // Enter fullscreen
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.webkitRequestFullscreen) {
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) {
                document.documentElement.msRequestFullscreen();
            }
        } else {
            // Exit fullscreen
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
    }

    updateScoreHistory() {
        this.scoreHistoryElement.innerHTML = '';

        // Display each period score
        this.app.periodScores.forEach((score) => {
            const periodElement = document.createElement('span');
            periodElement.className = 'period-score';
            periodElement.textContent = score;
            periodElement.contentEditable = 'true';
            this.scoreHistoryElement.appendChild(periodElement);
        });
    }

    updateScoreFontSize(value) {
        const scoreElements = document.querySelectorAll('.score');
        scoreElements.forEach(el => {
            el.style.fontSize = `${value}rem`;
        });
        document.getElementById('score-font-size-value').textContent = value;
        localStorage.setItem('scoreFontSize', value);
    }

    updateTimerFontSize(value) {
        this.app.timer.timerDisplay.style.fontSize = `${value}rem`;
        document.getElementById('timer-font-size-value').textContent = value;
        localStorage.setItem('timerFontSize', value);
    }
}

// Initialize the app when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', () => {
    window.scoreboardApp = new ScoreboardApp();
});

    </script>
</head>
<body>
    <audio id="alarm" src="audio/buzzer.mp3"></audio>

    <div class="scoreboard">
        <div class="scores">
            <div class="team">
                <div class="team-name" contenteditable="true">BLACK</div>
                <div class="score" id="score-team1">0</div>
            </div>
            <div class="team">
                <div class="team-name" contenteditable="true">WHITE</div>
                <div class="score" id="score-team2">0</div>
            </div>
        </div>
        <div class="timer-container">
            <div class="timer" id="timer">15:00</div>
            <div class="score-history" id="score-history"></div>
        </div>
        <div class="control-buttons">
            <button id="settings-btn" class="control-btn">
                <img src="icons/settings.svg" alt="Settings Icon" width="24" height="24">
            </button>
            <button id="fullscreen-btn" class="control-btn">
                <img src="icons/fullscreen.svg" alt="Fullscreen Icon" width="24" height="24">
            </button>
        </div>

        <div id="settings-panel" class="settings-panel">
            <div class="settings-group">
                <label for="timer-minutes">Timer (minutes)</label>
                <input type="number" id="timer-minutes" min="1" max="60" value="10">
                <button id="set-timer-btn">Set Timer</button>
            </div>
            <div class="settings-group">
                <label for="team1-name">Teams</label>
                <div class="team-settings">
                    <input type="text" id="team1-name" value="BLACK">
                    <button class="decrement-btn" id="team1-decrement">-1</button>
                </div>
                <div class="team-settings">
                    <input type="text" id="team2-name" value="WHITE">
                    <button class="decrement-btn" id="team2-decrement">-1</button>
                </div>
            </div>
            <div class="settings-group">
                <button id="reset-scores-btn">Reset Scores</button>
                <button id="reset-history-btn">Reset History</button>
                <button id="test-buzzer-btn">Test Buzzer</button>
                <button id="simulate-timer-end-btn">Test Timer End</button>
            </div>
            <div class="settings-group">
                <label for="score-font-size">Score Font Size: <span id="score-font-size-value">10</span>rem</label>
                <input type="range" id="score-font-size" min="5" max="15" value="10" step="0.5">
            </div>
            <div class="settings-group">
                <label for="timer-font-size">Timer Font Size: <span id="timer-font-size-value">14</span>rem</label>
                <input type="range" id="timer-font-size" min="6" max="20" value="14" step="0.5">
            </div>
            <div class="settings-group">
                <label>
                    <input type="checkbox" id="keep-screen-on"> Keep screen on (prevents device sleep)
                </label>
            </div>
        </div>
    </div>

</body>
</html>
